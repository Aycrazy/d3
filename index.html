<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript" src="./d3/d3.min.js"></script>
  <script type="text/javascript" src="./node_modules/jquery/dist/jquery.min.js"></script>

  <title>D3.js Intro</title>
  <style>
    h2 {
        text-indent: 50px;
    }
    svg {
      /*background-color: #DADFFF;];*/
      padding-bottom: 100px;
    }
  .bar {
    stroke: rgb(51, 122, 183);
    stroke-width: 1;
    fill: rgba(51, 122, 183, .5);
    opacity: .5;
  }
  .axis path, .axis line {
    fill: none;
    stroke: #ccc;
    shape-rendering: crispEdges;
  }
  .axis text {
    font-size: 11px;
  }

  text {
        font: 10px sans-serif;
        color: black;
    }

  </style>

</head>
<body>

<h2>An Introduction to D3.js</h2>

<div class="container">
  <div id="chart">
    <!-- <text>test</text> -->
  </div>
</div>


<script>
  var margin = 50,
  width = 900 - margin*2,
   height = 700 - margin*3,
   labelWidth = 0,
   barOffset = 8,
   barWidth = 18;

d3.json("small_aptc.json", function(error, data) {
  // Save JSON data as a global variable;
  dataset =data;
  // Call plot function that we will define below
  dataset = dataset.sort(function(a, b) { return b.yes_aptc - a.yes_aptc; })
  makeBarChart();
});
function makeBarChart() {
  // Select chart div and create an SVG element inside of it. This is where we will create our visualization.

  var counties = dataset.map(function(d){return d.county.replace('Census','')
    .replace('Borough','')
    .replace('and','')
    .replace('Area','');});

  var tooltip = d3.select('chart')
    .append('div')
    .style('position','absolute')
    .style('padding','0 10px')
    .style('background', 'white')
    .style('opacity', 0);

  var svg = d3.select("#chart")
    .append('svg')
    .attr('width', width + margin*2)
    .attr('height', height + margin*2);
  // setup x scale
  var xScale = d3.scaleBand()
    .domain(counties)
    .padding(.2)
    .rangeRound([0,width+margin]);
    
  var yScale = d3.scaleLinear()
    .domain([d3.min(dataset, function (d) { return d.yes_aptc; }),
            d3.max(dataset, function (d) { return d.yes_aptc; })])
    .range([height,0])
    .nice();
  


  var g = svg.append('g')
    .attr('transform', 'translate(' + margin + ',' + margin*3.15 + ')');
  
  g.selectAll("rect")
    .data(dataset)
    .enter()
    .append("rect")
    .attr("class", "bar")
    .attr("x", function(d,i) {
    console.log(dataset.length);
    return i*1.06 * (width/dataset.length)+barOffset; //Bar width of 20 plus 1 for padding;
    })
    .attr("y", margin/3+1)
    .attr("width", function(d) {
    return xScale.bandwidth(); //Bar width of 20 plus 1 for padding;
    })
    .attr("height",function (d) { return yScale(d.yes_aptc) })
    .on('mouseover', function(d){

      tooltip.transition().duration(200)
        .style('opacity', .9)

      tooltip.html(d)
      .style('left', (d3.event.pageX ) + 'px')
      .style('top', (d3.event.pagey ) + 'px')

      tempColor = this.style.fill;

      d3.select(this)
        .style('opacity',.2)


      })
      .on('mouseout', function(d){
        d3.select(this)
        .style('fill', tempColor)
        .style('opacity', .5)

  }); // credit - Learning Data Visualization with D3.js

  // g.selectAll("text")
  //   .data(dataset)
  //   .attr("y", height+margin*2)
  //   .attr("dy", ".35em")
  //   .text(function(d){
  //               return yScale(d.yes_aptc);
  //           });
    // .each(function() {
    //     labelWidth = Math.ceil(Math.max(labelWidth, this.getBBox().width));
    // });

  svg.append("g")
    .attr("transform", "translate(" + margin + "," + (margin*3.5) + ")")
    .call(d3.axisTop(xScale))
    .selectAll("text").
    attr("transform","rotate(90)")
    .attr("y", margin/3-15)
    .attr("x",-10-(margin))
    .style("font-size",'8px');

  svg.append("g")
    .attr("transform", "translate(" + margin + "," + margin*3.5 + ")")
    .call(d3.axisLeft(yScale));
  // text label for the x axis
  svg.append("text")             
    .attr("transform", "translate(" + (width/2) + " ," + (-70 + margin + 40) + ")")
    .style("text-anchor", "right")
    .text("Total Plan Selections");

  svg.append("g")
    .selectAll("text")
    .attr("transform","rotate(90)")
  // text label for the y axis
  svg.append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", margin/3)
    .attr("x",-0 - (height + margin))
    .style("text-anchor", "right")
    .text("APTC");


  
};
</script>


</body>
</html>
